path: ${oc.env:CONDA_PREFIX}/data/marmousi

resolve:
  relax: false
  call_key: __call__
  exc: resolve

ny: 2301
nx: 751
nt: 750
dy: 4.0
dx: 4.0
dt: 0.004

n_shots: 1
src_per_shot: 1

rec_per_shot: 384
d_rec: 6
rec_depth: 2

device: cuda:1

vp:
  __call__: ^^cwd|helpers|build_vp
  kw:
    path: ${...path}/vp.pt
    device: ${...device}
rec_loc_y:
  __call__: ^^cwd|helpers|take_first
  kw:
    path: ${...path}/rec_loc_y.pt
    device: ${...device}
src_loc_y:
  __call__: ^^cwd|helpers|build_src_loc_y
  kw:
    ny: ${...ny}
    nx: ${...nx}
    n_shots: ${...n_shots}
    src_per_shot: ${...src_per_shot}
    rel_idx_src_loc_y:
      upper_left: [0.5, 0.5]
      lower_left: [0.5, 0.5]
      lower_right: [0.5, 0.5]
      upper_right: [0.5, 0.5]
    nt: ${...nt}
    dt: ${...dt}
    device: ${...device}

src_amp_y:
  __call__: ^^cwd|helpers|take_first
  kw:
    path: ${...path}/src_amp_y.pt
    device: ${...device}

gbl_rec_loc:
  __call__: ^^cwd|helpers|build_gbl_rec_loc
  kw:
    ny: ${...ny}
    nx: ${...nx}
    downsample_y: 4
    downsample_x: 4
    device: ${...device}

gbl_obs_data:
  self_key: gbl_obs_data
  __call__: ^^cwd|helpers|build_gbl_obs_data
  kw:
    v: slf_${..self_key}.vp
    grid_spacing: ${...dy}
    dt: ${...dt}
    source_amplitudes: slf_${..self_key}.src_amp_y
    source_locations: slf_${..self_key}.src_loc_y
    receiver_locations: slf_${..self_key}.gbl_rec_loc
    accuracy: 8
    downsample_y: ${...gbl_rec_loc.kw.downsample_y}
    downsample_x: ${...gbl_rec_loc.kw.downsample_x}
    ny: ${...ny}
    nx: ${...nx}

plt:
  resolve:
    call_key: __plot__
    exc: resolve
    relax: false
  gbl_obs_data:
    __plot__: ^^|misfit_toys.types|FlatPlotter
    kw:
      callback: ^^cwd|plotters|plot_gbl_obs_data
      iter:
        none_dims: [1, 2]
        strides: [1, 1, 1]
      imshow:
        kw:
          aspect: auto
          cmap: seismic
        colorbar: true
        legend: false
        transpose: true
      title: Global Observed Data
