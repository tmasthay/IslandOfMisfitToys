name: documentation

on:
  workflow_dispatch:
    inputs:
      leaderboard:
        description: "Leaderboard content"
        required: true

permissions:
  contents: write

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v3
    - name: Install dependencies
      run: |
        pip install git+https://github.com/patrick-kidger/torchcubicspline.git
        pip install -e .
        pip install sphinx furo sphinx-autoapi sphinxcontrib-details-directive
        echo ${{ github.event.inputs.leaderboard }} > docs/leaderboard.rst

    - name: Sphinx build
      run: |
        cd docs
        make html

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: ${{ github.event_name == 'workflow_dispatch' }}
      with:
        publish_branch: gh-pages
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs/_build/html
        force_orphan: true

# name: documentation

# on:
#   workflow_dispatch:
#     inputs:
#       leaderboard:
#         description: "Leaderboard content"
#         required: true

# permissions:
#   contents: write

# jobs:
#   echo:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Echo leaderboard content
#         run: echo ${{ github.event.inputs.leaderboard }}
